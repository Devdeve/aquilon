# RENAME CFG_TLD TO TLD
ALTER TABLE CFG_TLD RENAME to TLD
ALTER TABLE CFG_PATH RENAME COLUMN CFG_TLD_ID to TLD_ID
ALTER TABLE CFG_PATH ADD CONSTRAINT CFG_PATH_TLD_FK FOREIGN KEY (TLD_ID) REFERENCES TLD (ID)

# drop afs_cell table
drop table afs_cell cascade constraints

# extend full name column in location
ALTER TABLE LOCATION MODIFY(FULLNAME VARCHAR2(255))

# recreate all the name/type unique
ALTER TABLE LOCATION ADD CONSTRAINT LOCATION_NAME_TYPE_UK unique ("NAME","LOCATION_TYPE")

# add the new rack columns
alter table rack add (rack_row varchar(4))
alter table rack add (rack_column number(4))
# add disk device name, deal with multiple unnamed rows.
ALTER TABLE DISK ADD (DEVICE_NAME VARCHAR(128))
UPDATE (SELECT * FROM DISK D1 WHERE EXISTS (SELECT 1 FROM DISK D2 WHERE D1.MACHINE_ID = D2.MACHINE_ID AND D1.ID > D2.ID)) SET DEVICE_NAME = 'sdb'
UPDATE DISK SET DEVICE_NAME = 'sda' WHERE DEVICE_NAME IS NULL
ALTER TABLE DISK ADD CONSTRAINT DISK_DEVICE_NAME_NN CHECK (('DEVICE_NAME' IS NOT NULL))
ALTER TABLE DISK ADD CONSTRAINT DISK_MACH_DEV_NAME_UK UNIQUE (MACHINE_ID, DEVICE_NAME)

# add new values for defaults and unit tests

UPDATE status SET name = 'production' WHERE name = 'prod'
UPDATE status SET name = 'development' WHERE name = 'dev'

# gh needed for Networks...
#INSERT INTO LOCATION (ID, PARENT_ID, NAME, FULLNAME, LOCATION_TYPE_ID, CREATION_DATE) VALUES (LOCATION_ID_SEQ.NEXTVAL, 171, 'gh', 'Grand Hyatt Plaza, Unit No E, F, G, Off Western Express Highway', 7, SYSDATE)

#Vendor aurora_vendor
# Already in the prod database
#INSERT INTO VENDOR (ID,NAME,CREATION_DATE,COMMENTS) VALUES (41,'aurora_vendor', SYSDATE,'Placeholder vendor for Aurora hardware.')

#Cpu aurora_cpu
# Already in the prod database
#INSERT INTO CPU (ID,NAME,VENDOR_ID,SPEED,CREATION_DATE,COMMENTS) VALUES(41,'aurora_cpu',41,0, SYSDATE,'Placeholder Aurora CPU type.')

#Model aurora_model with type aurora_node and zeroed MachineSpecs
INSERT INTO MODEL (ID,NAME,VENDOR_ID,CREATION_DATE,MACHINE_TYPE) VALUES(model_id_seq.nextval,'aurora_model',41,sysdate,'aurora_node')

INSERT INTO MACHINE_SPECS (ID,MODEL_ID,CPU_ID,CPU_QUANTITY,MEMORY,DISK_TYPE_ID,DISK_CAPACITY,NIC_COUNT) VALUES (mach_specs_id_seq.nextval, model_id_seq.currval, 41, 0, 0, 5, 0, 0)
